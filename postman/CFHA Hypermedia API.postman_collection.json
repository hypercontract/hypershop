{
	"variables": [],
	"info": {
		"name": "CFHA Hypermedia API",
		"_postman_id": "852e0a9b-6833-331e-d0f6-f4ee23f07892",
		"description": "",
		"schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json"
	},
	"item": [
		{
			"name": "Check API Root",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"var defaultContentType = postman.getEnvironmentVariable('defaultContentType');",
							"var baseUrl = postman.getEnvironmentVariable('baseUrl');",
							"var nsUri = postman.getEnvironmentVariable('nsUri');",
							"var apiRoot = JSON.parse(responseBody);",
							"",
							"var selfLink = apiRoot._links.self.href;",
							"var searchCatalogLink = apiRoot._links[nsUri + 'search-catalog'].href;",
							"var shoppingCartLink = apiRoot._links[nsUri + 'shopping-cart'].href;",
							"var ordersLink = apiRoot._links[nsUri + 'orders'].href;",
							"var userProfileLink = apiRoot._links[nsUri + 'user-profile'].href;",
							"",
							"tests['status code is 200 OK'] = responseCode.code === 200;",
							"tests['Content-Type header is ' + defaultContentType] = postman.getResponseHeader('Content-Type').match(_.escapeRegExp(defaultContentType));",
							"tests['response body contains the API version'] = apiRoot.version === '1.0';",
							"tests['response body contains self link'] = selfLink === baseUrl;",
							"tests['response body contains link to search catalog'] = searchCatalogLink === baseUrl + 'products/{?query}';",
							"tests['response body contains link to shopping cart'] = shoppingCartLink === baseUrl + 'shoppingCart/';",
							"tests['response body contains link to orders'] = ordersLink === baseUrl + 'orders/';",
							"tests['response body contains link to user profile'] = userProfileLink === baseUrl + 'userProfile/';"
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							"postman.clearEnvironmentVariables();",
							"",
							"postman.setEnvironmentVariable('defaultContentType', 'application/hal+json');",
							"postman.setEnvironmentVariable('baseUrl', 'http://localhost:3000/');",
							"postman.setEnvironmentVariable('nsUri', 'http://cfha.luchs.org/');",
							"",
							"var linksSchema = {",
							"    type: 'object',",
							"    properties: {",
							"        self: {",
							"            type: 'object',",
							"            properties: {",
							"                href: {",
							"                    type: 'string'",
							"                }",
							"            }",
							"        }",
							"    },",
							"    required: [",
							"        'self'",
							"    ]",
							"};",
							"",
							"postman.setEnvironmentVariable('productsSchema', JSON.stringify({",
							"    type: 'object',",
							"    properties: {",
							"        items: {",
							"            type: 'array',",
							"            items: {",
							"                type: 'object',",
							"                properties: {",
							"                    _id: {",
							"                        type: 'string'",
							"                    },",
							"                    name: {",
							"                        type: 'string'",
							"                    },",
							"                    description: {",
							"                        type: 'string'",
							"                    },",
							"                    price: {",
							"                        type: 'number'",
							"                    },",
							"                    _links: linksSchema",
							"                },",
							"                additionalProperties: false,",
							"                required: [",
							"                    '_id',",
							"                    'name',",
							"                    'description',",
							"                    'price',",
							"                    '_links'",
							"                ]",
							"            }",
							"        },",
							"        _links: linksSchema",
							"    },",
							"    additionalProperties: false,",
							"    required: [",
							"        'items',",
							"        '_links'",
							"    ]",
							"}));",
							"",
							"postman.setEnvironmentVariable('shoppingCartSchema', JSON.stringify({",
							"    type: 'object',",
							"    properties: {",
							"        items: {",
							"            type: 'array',",
							"            items: {",
							"                type: 'object',",
							"                properties: {",
							"                    _id: {",
							"                        type: 'string'",
							"                    },",
							"                    name: {",
							"                        type: 'string'",
							"                    },",
							"                    description: {",
							"                        type: 'string'",
							"                    },",
							"                    price: {",
							"                        type: 'number'",
							"                    },",
							"                    quantity: {",
							"                        type: 'number'",
							"                    },",
							"                    product: {",
							"                        type: 'string'",
							"                    },",
							"                    _links: linksSchema",
							"                },",
							"                additionalProperties: false,",
							"                required: [",
							"                    '_id',",
							"                    'name',",
							"                    'description',",
							"                    'price',",
							"                    'quantity',",
							"                    'product',",
							"                    '_links'",
							"                ]",
							"            }",
							"        },",
							"        totalPrice: {",
							"            type: 'number'",
							"        },",
							"        _links: linksSchema",
							"    },",
							"    additionalProperties: false,",
							"    required: [",
							"        'items',",
							"        'totalPrice',",
							"        '_links'",
							"    ]",
							"}));",
							"",
							"postman.setEnvironmentVariable('userProfileSchema', JSON.stringify({",
							"    type: 'object',",
							"    properties: {",
							"        paymentOptions: {",
							"            type: 'array',",
							"            items: {",
							"                type: 'object',",
							"                properties: {",
							"                    _id: {",
							"                        type: 'string'",
							"                    },",
							"                    accountOwner: {",
							"                        type: 'string'",
							"                    },",
							"                    iban: {",
							"                        type: 'string'",
							"                    },",
							"                    bic: {",
							"                        type: 'string'",
							"                    },",
							"                    _links: linksSchema",
							"                },",
							"                additionalProperties: false,",
							"                required: [",
							"                    '_id',",
							"                    'accountOwner',",
							"                    'iban',",
							"                    'bic',",
							"                    '_links'",
							"                ]",
							"            }",
							"        },",
							"        addresses: {",
							"            type: 'array',",
							"            items: {",
							"                type: 'object',",
							"                properties: {",
							"                    _id: {",
							"                        type: 'string'",
							"                    },",
							"                    name: {",
							"                        type: 'string'",
							"                    },",
							"                    street: {",
							"                        type: 'string'",
							"                    },",
							"                    zipCode: {",
							"                        type: 'string'",
							"                    },",
							"                    city: {",
							"                        type: 'string'",
							"                    },",
							"                    country: {",
							"                        type: 'string'",
							"                    },",
							"                    _links: linksSchema",
							"                },",
							"                additionalProperties: false,",
							"                required: [",
							"                    '_id',",
							"                    'name',",
							"                    'street',",
							"                    'zipCode',",
							"                    'city',",
							"                    'country',",
							"                    '_links'",
							"                ]",
							"            }",
							"        },",
							"        _links: linksSchema",
							"    },",
							"    additionalProperties: false,",
							"    required: [",
							"        'paymentOptions',",
							"        'addresses',",
							"        '_links'",
							"    ]",
							"}));",
							"",
							"postman.setEnvironmentVariable('orderSchema', JSON.stringify({",
							"    type: 'object',",
							"    properties: {",
							"        _id: {",
							"            type: 'string'",
							"        },",
							"        date: {",
							"            type: 'string'",
							"        },",
							"        status: {",
							"            type: 'string',",
							"            enum: [",
							"                'Cancelled',",
							"                'Delivered',",
							"                'InTransit',",
							"                'PaymentDue',",
							"                'PickupAvailable',",
							"                'Problem',",
							"                'Processing',",
							"                'Returned'",
							"            ]",
							"        },",
							"        items: {",
							"            type: 'array',",
							"            items: {",
							"                type: 'object',",
							"                properties: {",
							"                    'name': {",
							"                        type: 'string'",
							"                    },",
							"                    'description': {",
							"                        type: 'string'",
							"                    },",
							"                    'price': {",
							"                        type: 'number'",
							"                    },",
							"                    'quantity': {",
							"                        type: 'number'",
							"                    },",
							"                    'product': {",
							"                        type: 'string'",
							"                    },",
							"                },",
							"                additionalProperties: false,",
							"                required: [",
							"                    'name',",
							"                    'description',",
							"                    'price',",
							"                    'quantity',",
							"                    'product'",
							"                ]",
							"            }",
							"        },",
							"        billingAddress: {",
							"            type: 'object',",
							"            properties: {",
							"                name: {",
							"                    type: 'string'",
							"                },",
							"                street: {",
							"                    type: 'string'",
							"                },",
							"                zipCode: {",
							"                    type: 'string'",
							"                },",
							"                city: {",
							"                    type: 'string'",
							"                },",
							"                country: {",
							"                    type: 'string'",
							"                }",
							"            },",
							"            additionalProperties: false,",
							"            required: [",
							"                'name',",
							"                'street',",
							"                'zipCode',",
							"                'city',",
							"                'country'",
							"            ]",
							"        },",
							"        shippingAddress: {",
							"            type: 'object',",
							"            properties: {",
							"                name: {",
							"                    type: 'string'",
							"                },",
							"                street: {",
							"                    type: 'string'",
							"                },",
							"                zipCode: {",
							"                    type: 'string'",
							"                },",
							"                city: {",
							"                    type: 'string'",
							"                },",
							"                country: {",
							"                    type: 'string'",
							"                }",
							"            },",
							"            additionalProperties: false,",
							"            required: [",
							"                'name',",
							"                'street',",
							"                'zipCode',",
							"                'city',",
							"                'country'",
							"            ]",
							"        },",
							"        payment: {",
							"            type: 'object',",
							"            properties: {",
							"                accountOwner: {",
							"                    type: 'string'",
							"                },",
							"                iban: {",
							"                    type: 'string'",
							"                },",
							"                bic: {",
							"                    type: 'string'",
							"                },",
							"            },",
							"            additionalProperties: false,",
							"            required: [",
							"                'accountOwner',",
							"                'iban',",
							"                'bic'",
							"            ]",
							"        },",
							"        _links: linksSchema",
							"    },",
							"    additionalProperties: false,",
							"    required: [",
							"        '_id',",
							"        'date',",
							"        'items',",
							"        'billingAddress',",
							"        'shippingAddress',",
							"        'payment',",
							"        '_links'",
							"    ]",
							"}));",
							"",
							"postman.setEnvironmentVariable('ordersSchema', JSON.stringify({",
							"    type: 'object',",
							"    properties: {",
							"        items: {",
							"            type: 'array',",
							"            items: JSON.parse(postman.getEnvironmentVariable('orderSchema')),",
							"            ",
							"        },",
							"        _links: linksSchema",
							"    },",
							"    additionalProperties: false,",
							"    required: [",
							"        'items',",
							"        '_links'",
							"    ]",
							"}));",
							""
						]
					}
				}
			],
			"request": {
				"url": "{{baseUrl}}",
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{defaultContentType}}",
						"description": ""
					}
				],
				"body": {},
				"description": ""
			},
			"response": []
		},
		{
			"name": "View empty Shopping Cart",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"var schema = JSON.parse(postman.getEnvironmentVariable('shoppingCartSchema'));\r",
							"var defaultContentType = postman.getEnvironmentVariable('defaultContentType');\r",
							"var baseUrl = postman.getEnvironmentVariable('baseUrl');\r",
							"var nsUri = postman.getEnvironmentVariable('nsUri');\r",
							"var shoppingCart = JSON.parse(responseBody);\r",
							"\r",
							"var selfLink = shoppingCart._links.self.href;\r",
							"\r",
							"tests['status code is 200 OK'] = responseCode.code === 200;\r",
							"tests['Content-Type header is ' + defaultContentType] = postman.getResponseHeader('Content-Type').match(_.escapeRegExp(defaultContentType));\r",
							"tests['response body is a shopping cart'] = tv4.validate(shoppingCart, schema);\r",
							"tests['response body contains no shopping cart items'] = shoppingCart.items.length === 0;\r",
							"tests['response body contains self link'] = selfLink === baseUrl + 'shoppingCart/';\r",
							"tests['response body contains no place order link'] = _.isUndefined(shoppingCart._links[nsUri + 'place-order']);\r",
							""
						]
					}
				}
			],
			"request": {
				"url": "{{baseUrl}}shoppingCart",
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{defaultContentType}}",
						"description": ""
					}
				],
				"body": {},
				"description": ""
			},
			"response": []
		},
		{
			"name": "Search Catalog for Products",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"var schema = JSON.parse(postman.getEnvironmentVariable('productsSchema'));\r",
							"var defaultContentType = postman.getEnvironmentVariable('defaultContentType');\r",
							"var baseUrl = postman.getEnvironmentVariable('baseUrl');\r",
							"var nsUri = postman.getEnvironmentVariable('nsUri');\r",
							"var products = JSON.parse(responseBody);\r",
							"\r",
							"var selfLink = products._links.self.href;\r",
							"\r",
							"tests['status code is 200 OK'] = responseCode.code === 200;\r",
							"tests['Content-Type header is ' + defaultContentType] = postman.getResponseHeader('Content-Type').match(_.escapeRegExp(defaultContentType));\r",
							"tests['response body is a list of products'] = tv4.validate(products, schema);\r",
							"tests['response body contains at least 2 products'] = products.items.length >= 2;\r",
							"tests['response body contains self link'] = selfLink === baseUrl + 'products/';\r",
							"\r",
							"var allProductsHaveSelfLink = true;\r",
							"var allProductsHaveSCLink = true;\r",
							"\r",
							"products.items.forEach(function (product) {\r",
							"    var productHasSelfLink = product._links.self.href.match(baseUrl + 'products/.*/');\r",
							"    var productHasSCLink = product._links[nsUri + 'add-to-shopping-cart'].href === baseUrl + 'shoppingCart/';\r",
							"    \r",
							"    allProductsHaveSelfLink = allProductsHaveSelfLink && productHasSelfLink;\r",
							"    allProductsHaveSCLink = allProductsHaveSCLink && productHasSCLink;\r",
							"});\r",
							"\r",
							"tests['all products have self link'] = allProductsHaveSelfLink;\r",
							"tests['all products have add to shopping cart link'] = allProductsHaveSCLink;\r",
							"\r",
							"postman.setEnvironmentVariable(\"productId1\", products.items[0]._id);\r",
							"postman.setEnvironmentVariable(\"productId2\", products.items[1]._id);\r",
							""
						]
					}
				}
			],
			"request": {
				"url": {
					"raw": "{{baseUrl}}products/?query=nostrum",
					"host": [
						"{{baseUrl}}products"
					],
					"path": [
						""
					],
					"query": [
						{
							"key": "query",
							"value": "nostrum",
							"equals": true,
							"description": ""
						}
					],
					"variable": []
				},
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{defaultContentType}}",
						"description": ""
					}
				],
				"body": {},
				"description": ""
			},
			"response": []
		},
		{
			"name": "Add Product to Shopping Cart #1",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"var baseUrl = postman.getEnvironmentVariable('baseUrl');\r",
							"\r",
							"tests['status code is 201 Created'] = responseCode.code === 201;\r",
							"tests['Location header redirects to /shoppingCart'] = postman.getResponseHeader('Location') === baseUrl + 'shoppingCart/'; \r",
							"tests['response body is empty'] = responseBody === '';\r",
							"\r",
							"postman.setEnvironmentVariable('shoppingCartUrl', postman.getResponseHeader('Location'));\r",
							""
						]
					}
				}
			],
			"request": {
				"url": "{{baseUrl}}shoppingCart/items/",
				"method": "POST",
				"header": [
					{
						"key": "Accept",
						"value": "{{defaultContentType}}",
						"description": ""
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"description": ""
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n\t\"product\": \"{{productId1}}\",\n\t\"quantity\": 1\n}"
				},
				"description": ""
			},
			"response": []
		},
		{
			"name": "Add Product to Shopping Cart #2",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"var baseUrl = postman.getEnvironmentVariable('baseUrl');\r",
							"\r",
							"tests['status code is 201 Created'] = responseCode.code === 201;\r",
							"tests['Location header redirects to /shoppingCart'] = postman.getResponseHeader('Location') === baseUrl + 'shoppingCart/'; \r",
							"tests['response body is empty'] = responseBody === '';\r",
							"\r",
							"postman.setEnvironmentVariable('shoppingCartUrl', postman.getResponseHeader('Location'));\r",
							""
						]
					}
				}
			],
			"request": {
				"url": "{{baseUrl}}shoppingCart/items/",
				"method": "POST",
				"header": [
					{
						"key": "Accept",
						"value": "{{defaultContentType}}",
						"description": ""
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"description": ""
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n\t\"product\": \"{{productId2}}\",\n\t\"quantity\": 1\n}"
				},
				"description": ""
			},
			"response": []
		},
		{
			"name": "View Shopping Cart",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"var schema = JSON.parse(postman.getEnvironmentVariable('shoppingCartSchema'));\r",
							"var defaultContentType = postman.getEnvironmentVariable('defaultContentType');\r",
							"var baseUrl = postman.getEnvironmentVariable('baseUrl');\r",
							"var nsUri = postman.getEnvironmentVariable('nsUri');\r",
							"var shoppingCart = JSON.parse(responseBody);\r",
							"\r",
							"var selfLink = shoppingCart._links.self.href;\r",
							"\r",
							"tests['status code is 200 OK'] = responseCode.code === 200;\r",
							"tests['Content-Type header is ' + defaultContentType] = postman.getResponseHeader('Content-Type').match(_.escapeRegExp(defaultContentType));\r",
							"tests['response body is a shopping cart'] = tv4.validate(shoppingCart, schema);\r",
							"tests['response body contains exactly 2 shopping cart items'] = shoppingCart.items.length === 2;\r",
							"tests['response body contains self link'] = selfLink === baseUrl + 'shoppingCart/';\r",
							"tests['response body contains place order link'] = shoppingCart._links[nsUri + 'place-order'].href.match(baseUrl + 'orders/');\r",
							"\r",
							"var allItemsHaveSelfLink = true;\r",
							"var allItemsHaveUpdateLink = true;\r",
							"var allItemsHaveRemoveLink = true;\r",
							"\r",
							"shoppingCart.items.forEach(function (item) {\r",
							"    var itemHasSelfLink = item._links.self.href.match(baseUrl + 'shoppingCart/items/.*/');\r",
							"    var itemHasUpdateLink = item._links[nsUri + 'update-quantity'].href.match(baseUrl + 'shoppingCart/items/.*/');\r",
							"    var itemHasRemoveLink = item._links[nsUri + 'remove'].href.match(baseUrl + 'shoppingCart/items/.*/');\r",
							"    \r",
							"    allItemsHaveSelfLink = allItemsHaveSelfLink && itemHasSelfLink;\r",
							"    allItemsHaveUpdateLink = allItemsHaveUpdateLink && itemHasUpdateLink;\r",
							"    allItemsHaveRemoveLink = allItemsHaveRemoveLink && itemHasRemoveLink;\r",
							"});\r",
							"\r",
							"tests['all items have self link'] = allItemsHaveSelfLink;\r",
							"tests['all items have update quantity link'] = allItemsHaveUpdateLink;\r",
							"tests['all items have remove link'] = allItemsHaveRemoveLink;\r",
							"\r",
							"postman.setEnvironmentVariable(\"shoppingCartItemId1\", shoppingCart.items[0]._id);\r",
							"postman.setEnvironmentVariable(\"shoppingCartItemId2\", shoppingCart.items[1]._id);\r",
							""
						]
					}
				}
			],
			"request": {
				"url": "{{shoppingCartUrl}}",
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{defaultContentType}}",
						"description": ""
					}
				],
				"body": {},
				"description": ""
			},
			"response": []
		},
		{
			"name": "Update quantity of Shopping Cart Item",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"var baseUrl = postman.getEnvironmentVariable('baseUrl');\r",
							"\r",
							"tests['status code is 204 No Content'] = responseCode.code === 204;\r",
							"tests['Location header redirects to /shoppingCart'] = postman.getResponseHeader('Location') === baseUrl + 'shoppingCart/'; \r",
							"tests['response body is empty'] = responseBody === '';\r",
							"\r",
							"postman.setEnvironmentVariable('shoppingCartUrl', postman.getResponseHeader('Location'));\r",
							""
						]
					}
				}
			],
			"request": {
				"url": "{{baseUrl}}shoppingCart/items/{{shoppingCartItemId1}}/",
				"method": "PATCH",
				"header": [
					{
						"key": "Accept",
						"value": "{{defaultContentType}}",
						"description": ""
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"description": ""
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n\t\"quantity\": 2\n}"
				},
				"description": "\t"
			},
			"response": []
		},
		{
			"name": "Remove Item from Shopping Cart",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"var baseUrl = postman.getEnvironmentVariable('baseUrl');\r",
							"\r",
							"tests['status code is 204 No Content'] = responseCode.code === 204;\r",
							"tests['Location header redirects to /shoppingCart'] = postman.getResponseHeader('Location') === baseUrl + 'shoppingCart/'; \r",
							"tests['response body is empty'] = responseBody === '';\r",
							"\r",
							"postman.setEnvironmentVariable('shoppingCartUrl', postman.getResponseHeader('Location'));\r",
							""
						]
					}
				}
			],
			"request": {
				"url": "{{baseUrl}}shoppingCart/items/{{shoppingCartItemId2}}/",
				"method": "DELETE",
				"header": [
					{
						"key": "Accept",
						"value": "{{defaultContentType}}",
						"description": ""
					}
				],
				"body": {
					"mode": "raw",
					"raw": "\n"
				},
				"description": "\t"
			},
			"response": []
		},
		{
			"name": "View updated Shopping Cart",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"var schema = JSON.parse(postman.getEnvironmentVariable('shoppingCartSchema'));\r",
							"var defaultContentType = postman.getEnvironmentVariable('defaultContentType');\r",
							"var baseUrl = postman.getEnvironmentVariable('baseUrl');\r",
							"var nsUri = postman.getEnvironmentVariable('nsUri');\r",
							"var shoppingCart = JSON.parse(responseBody);\r",
							"\r",
							"var selfLink = shoppingCart._links.self.href;\r",
							"\r",
							"tests['status code is 200 OK'] = responseCode.code === 200;\r",
							"tests['Content-Type header is ' + defaultContentType] = postman.getResponseHeader('Content-Type').match(_.escapeRegExp(defaultContentType));\r",
							"tests['response body is a shopping cart'] = tv4.validate(shoppingCart, schema);\r",
							"tests['response body contains 1 shopping cart item'] = shoppingCart.items.length === 1;\r",
							"tests['shopping cart item has a quantity of 2'] = shoppingCart.items[0].quantity === 2;\r",
							"tests['response body contains self link'] = selfLink === baseUrl + 'shoppingCart/';\r",
							"tests['response body contains place order link'] = shoppingCart._links[nsUri + 'place-order'].href.match(baseUrl + 'orders/');\r",
							"\r",
							"var allItemsHaveSelfLink = true;\r",
							"var allItemsHaveUpdateLink = true;\r",
							"var allItemsHaveRemoveLink = true;\r",
							"\r",
							"shoppingCart.items.forEach(function (item) {\r",
							"    var itemHasSelfLink = item._links.self.href.match(baseUrl + 'shoppingCart/items/.*/');\r",
							"    var itemHasUpdateLink = item._links[nsUri + 'update-quantity'].href.match(baseUrl + 'shoppingCart/items/.*/');\r",
							"    var itemHasRemoveLink = item._links[nsUri + 'remove'].href.match(baseUrl + 'shoppingCart/items/.*/');\r",
							"    \r",
							"    allItemsHaveSelfLink = allItemsHaveSelfLink && itemHasSelfLink;\r",
							"    allItemsHaveUpdateLink = allItemsHaveUpdateLink && itemHasUpdateLink;\r",
							"    allItemsHaveRemoveLink = allItemsHaveRemoveLink && itemHasRemoveLink;\r",
							"});\r",
							"\r",
							"tests['all items have self link'] = allItemsHaveSelfLink;\r",
							"tests['all items have update quantity link'] = allItemsHaveUpdateLink;\r",
							"tests['all items have remove link'] = allItemsHaveRemoveLink;\r",
							"\r",
							"postman.setEnvironmentVariable(\"lineItems\", JSON.stringify(shoppingCart.items.map(function (item) {\r",
							"    return _.omit(item, ['_id', '_links']);\r",
							"})));"
						]
					}
				}
			],
			"request": {
				"url": "{{shoppingCartUrl}}",
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{defaultContentType}}",
						"description": ""
					}
				],
				"body": {},
				"description": ""
			},
			"response": []
		},
		{
			"name": "Select Billing/Shipping Address, Payment",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"var schema = JSON.parse(postman.getEnvironmentVariable('userProfileSchema'));\r",
							"var defaultContentType = postman.getEnvironmentVariable('defaultContentType');\r",
							"var baseUrl = postman.getEnvironmentVariable('baseUrl');\r",
							"var userProfile = JSON.parse(responseBody);\r",
							"\r",
							"var selfLink = userProfile._links.self.href;\r",
							"\r",
							"tests['status code is 200 OK'] = responseCode.code === 200;\r",
							"tests['Content-Type header is ' + defaultContentType] = postman.getResponseHeader('Content-Type').match(_.escapeRegExp(defaultContentType));\r",
							"tests['response body is a user profile'] = tv4.validate(userProfile, schema);\r",
							"tests['response body contains at least 1 payment option'] = userProfile.paymentOptions.length >= 1;\r",
							"tests['response body contains at least 2 addresses'] = userProfile.addresses.length >= 2;\r",
							"tests['response body contains self link'] = selfLink === baseUrl + 'userProfile/';\r",
							"\r",
							"var allAddressesHaveSelfLink = true\r",
							"\r",
							"userProfile.addresses.forEach(function (address) {\r",
							"    var addressHasSelfLink = address._links.self.href.match(baseUrl + 'userProfile/addresses/.*/');\r",
							"    \r",
							"    allAddressesHaveSelfLink = allAddressesHaveSelfLink && addressHasSelfLink;\r",
							"});\r",
							"\r",
							"tests['all addresses have self link'] = allAddressesHaveSelfLink;\r",
							"\r",
							"var allPaymentOptionsHaveSelfLink = true\r",
							"\r",
							"userProfile.paymentOptions.forEach(function (paymentOption) {\r",
							"    var paymentOptionHasSelfLink = paymentOption._links.self.href.match(baseUrl + 'userProfile/paymentOptions/.*/');\r",
							"    \r",
							"    allPaymentOptionsHaveSelfLink = allPaymentOptionsHaveSelfLink && paymentOptionHasSelfLink;\r",
							"});\r",
							"\r",
							"tests['all payment options have self link'] = allPaymentOptionsHaveSelfLink;\r",
							"\r",
							"postman.setEnvironmentVariable(\"payment\", JSON.stringify(_.omit(userProfile.paymentOptions[0], ['_id', '_links'])));\r",
							"postman.setEnvironmentVariable(\"billingAddress\", JSON.stringify(_.omit(userProfile.addresses[0], ['_id', '_links'])));\r",
							"postman.setEnvironmentVariable(\"shippingAddress\", JSON.stringify(_.omit(userProfile.addresses[1], ['_id', '_links'])));\r",
							"\r",
							""
						]
					}
				}
			],
			"request": {
				"url": "{{baseUrl}}userProfile/",
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{defaultContentType}}",
						"description": ""
					}
				],
				"body": {},
				"description": ""
			},
			"response": []
		},
		{
			"name": "Place Order",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"var baseUrl = postman.getEnvironmentVariable('baseUrl');",
							"",
							"tests['status code is 201 Created'] = responseCode.code === 201;",
							"tests['Location header redirects to /orders/{orderId}'] = postman.getResponseHeader('Location').match(baseUrl + 'orders/.*/');",
							"tests['response body is empty'] = responseBody === '';",
							"",
							"postman.setEnvironmentVariable('orderUrl', postman.getResponseHeader('Location'));",
							""
						]
					}
				}
			],
			"request": {
				"url": "{{baseUrl}}orders/",
				"method": "POST",
				"header": [
					{
						"key": "Accept",
						"value": "{{defaultContentType}}",
						"description": ""
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"description": ""
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n\t\"items\": {{lineItems}},\n\t\"billingAddress\": {{billingAddress}},\n\t\"shippingAddress\": {{shippingAddress}},\n\t\"payment\": {{payment}}\n}"
				},
				"description": ""
			},
			"response": []
		},
		{
			"name": "View Order status",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"var schema = JSON.parse(postman.getEnvironmentVariable('orderSchema'));\r",
							"var defaultContentType = postman.getEnvironmentVariable('defaultContentType');\r",
							"var baseUrl = postman.getEnvironmentVariable('baseUrl');\r",
							"var nsUri = postman.getEnvironmentVariable('nsUri');\r",
							"var order = JSON.parse(responseBody);\r",
							"\r",
							"var selfLink = order._links.self.href;\r",
							"\r",
							"tests['status code is 200 OK'] = responseCode.code === 200;\r",
							"tests['Content-Type header is ' + defaultContentType] = postman.getResponseHeader('Content-Type').match(_.escapeRegExp(defaultContentType));\r",
							"tests['response body is a order'] = tv4.validate(order, schema);\r",
							"tests['response body contains 1 line item'] = order.items.length === 1;\r",
							"tests['order status is PaymentDue'] = order.status === 'PaymentDue';\r",
							"tests['response body contains self link'] = selfLink.match(baseUrl + 'orders/.*/');\r",
							"tests['response body contains cancel link'] = order._links[nsUri + 'cancel'].href.match(baseUrl + 'orders/.*/');\r",
							""
						]
					}
				}
			],
			"request": {
				"url": "{{orderUrl}}",
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{defaultContentType}}",
						"description": ""
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n\t\"items\": {{lineItems}},\n\t\"billingAddress\": {{billingAddress}},\n\t\"shippingAddress\": {{shippingAddress}},\n\t\"payment\": {{payment}}\n}"
				},
				"description": ""
			},
			"response": []
		},
		{
			"name": "Cancel Order",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"var baseUrl = postman.getEnvironmentVariable('baseUrl');\r",
							"\r",
							"tests['status code is 204 No Content'] = responseCode.code === 204;\r",
							"tests['Location header redirects to /orders/{orderId}'] = postman.getResponseHeader('Location').match(baseUrl + 'orders/.*/');\r",
							"tests['response body is empty'] = responseBody === '';\r",
							""
						]
					}
				}
			],
			"request": {
				"url": "{{orderUrl}}",
				"method": "PATCH",
				"header": [
					{
						"key": "Accept",
						"value": "{{defaultContentType}}",
						"description": ""
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"description": ""
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n\t\"status\": \"Cancelled\"\n}"
				},
				"description": ""
			},
			"response": []
		},
		{
			"name": "View updated Order status",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"var schema = JSON.parse(postman.getEnvironmentVariable('orderSchema'));\r",
							"var defaultContentType = postman.getEnvironmentVariable('defaultContentType');\r",
							"var baseUrl = postman.getEnvironmentVariable('baseUrl');\r",
							"var nsUri = postman.getEnvironmentVariable('nsUri');\r",
							"var order = JSON.parse(responseBody);\r",
							"\r",
							"var selfLink = order._links.self.href;\r",
							"\r",
							"tests['status code is 200 OK'] = responseCode.code === 200;\r",
							"tests['Content-Type header is ' + defaultContentType] = postman.getResponseHeader('Content-Type').match(_.escapeRegExp(defaultContentType));\r",
							"tests['response body is a order'] = tv4.validate(order, schema);\r",
							"tests['order status is Cancelled'] = order.status === 'Cancelled';\r",
							"tests['response body contains self link'] = selfLink.match(baseUrl + 'orders/.*/');\r",
							"tests['response body contains no cancel link'] = _.isUndefined(order._links[nsUri + 'cancel']);\r",
							""
						]
					}
				}
			],
			"request": {
				"url": "{{orderUrl}}",
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{defaultContentType}}",
						"description": ""
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n\t\"items\": {{lineItems}},\n\t\"billingAddress\": {{billingAddress}},\n\t\"shippingAddress\": {{shippingAddress}},\n\t\"payment\": {{payment}}\n}"
				},
				"description": ""
			},
			"response": []
		},
		{
			"name": "View Orders",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"var schema = JSON.parse(postman.getEnvironmentVariable('ordersSchema'));",
							"var defaultContentType = postman.getEnvironmentVariable('defaultContentType');",
							"var baseUrl = postman.getEnvironmentVariable('baseUrl');",
							"var nsUri = postman.getEnvironmentVariable('nsUri');",
							"var orders = JSON.parse(responseBody);",
							"",
							"var selfLink = orders._links.self.href;",
							"",
							"tests['status code is 200 OK'] = responseCode.code === 200;",
							"tests['Content-Type header is ' + defaultContentType] = postman.getResponseHeader('Content-Type').match(_.escapeRegExp(defaultContentType));",
							"tests['response body is a list of orders'] = tv4.validate(orders, schema);",
							"tests['response body contains at least 1 order'] = orders.items.length >= 1;",
							"tests['response body contains self link'] = selfLink.match(baseUrl + 'orders/');",
							"",
							"var allOrdersHaveSelfLink = true;",
							"var allOpenOrdersHaveCancelLink = true;",
							"",
							"orders.items.forEach(function (order) {",
							"    var orderHasSelfLink = order._links.self.href.match(baseUrl + 'orders/.*/');",
							"    allOrdersHaveSelfLink = allOrdersHaveSelfLink && orderHasSelfLink;",
							"    ",
							"    if (['PaymentDue', 'Processing'].includes(order.status)) {",
							"        var orderHasCancelLink = order._links[nsUri + 'cancel'].href.match(baseUrl + 'orders/.*/');",
							"        allOpenOrdersHaveCancelLink = allOpenOrdersHaveCancelLink && orderHasCancelLink;",
							"    }",
							"    ",
							"});",
							"",
							"tests['all orders have self link'] = allOrdersHaveSelfLink;",
							"tests['all open orders have cancel link'] = allOpenOrdersHaveCancelLink;",
							""
						]
					}
				}
			],
			"request": {
				"url": "{{baseUrl}}orders/",
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "{{defaultContentType}}",
						"description": ""
					}
				],
				"body": {},
				"description": ""
			},
			"response": []
		}
	]
}